extends layout

block extraScripts
  meta(http-equiv="cache-control" content="max-age=0")
  meta(http-equiv="cache-control" content="no-cache")
  meta(http-equiv="expires" content="0")
  meta( http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT")
  meta( http-equiv="pragma" content="no-cache")

block content
  
  #error-bar
    if error
      .error= error

  #title-bar
    h1= title

  if !authenticated
    #login-needed 
      a(href="auth/login") Login
      |  to create and edit content.

  mixin submissionsrow(s)
    .mentor-table
      table.submissions-list#submission-item
        thead
          td(colspan='2') Metadata
        if s.request_type
          tr.submission-row
            td.title Request Type
            td= ( s.request_type == 'request-help' ? 'Let Us Help' : (s.request_type == 'request-whatsapp' ? 'Join Whatsapp Group' : (s.request_type == 'request-intro' ? 'Request social media introduction' : 'Request online meeting')))
        if s.mentor
          tr.submission-row
            td.title Mentor
            td(style='text-transform: capitalize')
              a(href='mentor/'+s.mentor+'.md')= s.mentor.split('_').join(' ')
        if s.timestamp
          tr.submission-row
            td.title Time received
            td= moment(s.timestamp).format('DD/MM/YYYY hh:mma')
    .mentor-table
      table.submissions-list#submission-item
        thead
          td(colspan='2') Sender Information
        if s.name
          tr.submission-row
            td.title Name
            td= s.name
        if s.email
          tr.submission-row
            td.title Email
            td= s.email
        if s.mobile
          tr.submission-row
            td.title Mobile number
            td= s.mobile
        if s.dob
          tr.submission-row
            td.title Date of Birth
            td= moment(s.dob).format('DD/MM/YYYY')
        if s.connect_through
          tr.submission-row
            td.title Connect Through
            td(style='text-transform: capitalize') #{s.connect_through}: #{s.social_account}
        if s.comm_method
          tr.submission-row
            td.title Preferred communication method
            td(style='text-transform: capitalize')= s.comm_method.split('-').join(' ')
        if s.interests
          tr.submission-row
            td.title Interests
            td= s.interests
        if s.introduction
          tr.submission-row
            td.title Introduce yourself
            td= s.introduction
        if s.contact_reason
          tr.submission-row
            td.title Why would you like to contact this mentor?
            td= s.contact_reason
          


  mixin filterBar
    +submissionsrow(submissions[0])



  if authenticated
      +filterBar

  //- .dialog#create-dialog(title="Create New")
  //-   label Mentor Reference
  //-   input#mentor-ref(name="mentor-ref" type="text")
  //-   button.dg-btn#submit-ref(type="button" onclick="createNewMentor()") Create

  //- .dialog#delete-dialog(title="Delete Mentor")
  //-   p Are you sure you want to delete this mentor? 
  //-   button.dg-btn#cancel-delete(type="button" onclick="$('#delete-dialog').dialog('close')") No
  //-   button.dg-btn#delete-mentor(type="button" onclick="confirmDeleteMentor()") Yes


  script.
    var selectedfilter = 'all';

    $('#type-filter').click(function(e){
      e.stopPropagation();
      $(this).toggleClass('open');
    });

    $('#type-dropdown').click(function(e){
      e.stopPropagation();
      console.log(e.target)
      selectedFilter = e.target.getAttribute('data-val');
      var text = e.target.innerHTML;
      $('#selected-filter').text(text);
      $('#type-filter').removeClass('open');
      switch(selectedFilter){
        case 'all':
          $('tr.submission-row').each(function(i, e){
            $(e).show()
          })
        break;
        default:
          $('tr.submission-row').each(function(i, e){
            var att = e.getAttribute('data-type');
            if (att == selectedFilter)
              $(e).show()
            else 
              $(e).hide()
          })
        break;
      }
    });

    $(document).ready(function(){
      
    });

